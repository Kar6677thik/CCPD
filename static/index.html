<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraud Detection Agent | Intelligent ML System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- Background Effects -->
    <div class="bg-gradient"></div>
    <div class="bg-grid"></div>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        <path d="M9 12l2 2 4-4"/>
                    </svg>
                </div>
                <div class="logo-text">
                    <h1>Fraud Detection Agent</h1>
                    <span>Intelligent ML-Powered Protection</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="loadModels()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                        <path d="M21 12a9 9 0 11-9-9"/>
                        <path d="M21 3v9h-9"/>
                    </svg>
                    Load Models
                </button>
                <button class="btn btn-primary" onclick="trainModels()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                        <polygon points="5 3 19 12 5 21 5 3"/>
                    </svg>
                    Train Models
                </button>
            </div>
        </header>

        <!-- Stats Grid -->
        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon accuracy">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                </div>
                <div class="stat-info">
                    <span class="stat-label">Accuracy</span>
                    <span class="stat-value" id="stat-accuracy">--</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon precision">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <circle cx="12" cy="12" r="6"/>
                        <circle cx="12" cy="12" r="2"/>
                    </svg>
                </div>
                <div class="stat-info">
                    <span class="stat-label">Precision</span>
                    <span class="stat-value" id="stat-precision">--</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon recall">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </div>
                <div class="stat-info">
                    <span class="stat-label">Recall</span>
                    <span class="stat-value" id="stat-recall">--</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon auc">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3v18h18"/>
                        <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                    </svg>
                </div>
                <div class="stat-info">
                    <span class="stat-label">AUC Score</span>
                    <span class="stat-value" id="stat-auc">--</span>
                </div>
            </div>
        </section>

        <!-- Main Content Grid -->
        <div class="main-grid">
            <!-- Left Column -->
            <div class="column-left">
                <!-- Detection Panel -->
                <div class="card detection-panel">
                    <div class="card-header">
                        <h2>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                <line x1="12" y1="9" x2="12" y2="13"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                            Real-time Detection
                        </h2>
                        <button class="btn-icon" onclick="loadSampleTransaction()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                <polyline points="1 4 1 10 7 10"/>
                                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                            </svg>
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="detection-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Amount ($)</label>
                                    <input type="number" id="input-amount" placeholder="149.62" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>V1</label>
                                    <input type="number" id="input-v1" placeholder="-1.36" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>V2</label>
                                    <input type="number" id="input-v2" placeholder="-0.07" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>V3</label>
                                    <input type="number" id="input-v3" placeholder="2.54" step="0.01">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>V4</label>
                                    <input type="number" id="input-v4" placeholder="1.38" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>V5</label>
                                    <input type="number" id="input-v5" placeholder="-0.34" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>V14</label>
                                    <input type="number" id="input-v14" placeholder="-0.31" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>V17</label>
                                    <input type="number" id="input-v17" placeholder="0.21" step="0.01">
                                </div>
                            </div>
                            <button class="btn btn-primary btn-full" onclick="detectFraud()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                    <circle cx="11" cy="11" r="8"/>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                </svg>
                                Analyze Transaction
                            </button>
                        </div>
                        
                        <!-- Detection Result -->
                        <div class="detection-result hidden" id="detection-result">
                            <div class="result-header">
                                <div class="result-status" id="result-status">
                                    <div class="status-icon"></div>
                                    <span class="status-text">Analyzing...</span>
                                </div>
                                <div class="result-probability" id="result-probability">
                                    <span class="prob-value">0%</span>
                                    <span class="prob-label">Fraud Probability</span>
                                </div>
                            </div>
                            <div class="result-models" id="result-models">
                                <!-- Model predictions will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CSV Upload Panel -->
                <div class="card csv-upload-panel">
                    <div class="card-header">
                        <h2>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            CSV Upload & Analysis
                        </h2>
                        <button class="btn-icon" onclick="analyzeSampleCSV()" title="Test with Sample CSV">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                            </svg>
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="upload-zone" id="upload-zone" onclick="document.getElementById('csv-input').click()">
                            <input type="file" id="csv-input" accept=".csv" hidden onchange="handleCSVUpload(event)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="48" height="48">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            <p>Click or drag CSV file here</p>
                            <span class="upload-hint">Required: V1-V28, Amount columns</span>
                        </div>
                        
                        <!-- Upload Results -->
                        <div class="upload-results hidden" id="upload-results">
                            <div class="upload-summary">
                                <div class="summary-stat">
                                    <span class="summary-value" id="upload-total">0</span>
                                    <span class="summary-label">Total</span>
                                </div>
                                <div class="summary-stat fraud">
                                    <span class="summary-value" id="upload-fraud">0</span>
                                    <span class="summary-label">Fraud</span>
                                </div>
                                <div class="summary-stat safe">
                                    <span class="summary-value" id="upload-normal">0</span>
                                    <span class="summary-label">Normal</span>
                                </div>
                                <div class="summary-stat">
                                    <span class="summary-value" id="upload-accuracy">--</span>
                                    <span class="summary-label">Accuracy</span>
                                </div>
                            </div>
                            
                            <div class="risk-distribution" id="risk-distribution">
                                <!-- Risk bars will be inserted here -->
                            </div>
                            
                            <div class="results-table-container">
                                <table class="results-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Amount</th>
                                            <th>Prediction</th>
                                            <th>Probability</th>
                                            <th>Risk</th>
                                            <th>Actual</th>
                                        </tr>
                                    </thead>
                                    <tbody id="results-table-body">
                                        <!-- Results will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dataset Info -->
                <div class="card dataset-info">
                    <div class="card-header">
                        <h2>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                                <ellipse cx="12" cy="5" rx="9" ry="3"/>
                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                            </svg>
                            Dataset Overview
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="dataset-stats">
                            <div class="dataset-stat">
                                <span class="ds-value" id="ds-total">--</span>
                                <span class="ds-label">Total Transactions</span>
                            </div>
                            <div class="dataset-stat fraud">
                                <span class="ds-value" id="ds-fraud">--</span>
                                <span class="ds-label">Fraud Cases</span>
                            </div>
                            <div class="dataset-stat">
                                <span class="ds-value" id="ds-normal">--</span>
                                <span class="ds-label">Normal Transactions</span>
                            </div>
                            <div class="dataset-stat">
                                <span class="ds-value" id="ds-ratio">--</span>
                                <span class="ds-label">Fraud Ratio</span>
                            </div>
                        </div>
                        <div class="distribution-chart">
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="column-right">
                <!-- Model Comparison -->
                <div class="card model-comparison">
                    <div class="card-header">
                        <h2>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                                <line x1="18" y1="20" x2="18" y2="10"/>
                                <line x1="12" y1="20" x2="12" y2="4"/>
                                <line x1="6" y1="20" x2="6" y2="14"/>
                            </svg>
                            Model Performance
                        </h2>
                        <button class="btn-icon" onclick="refreshComparison()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                <polyline points="23 4 23 10 17 10"/>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                            </svg>
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="comparison-chart">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                        <div class="model-cards" id="model-cards">
                            <div class="model-card">
                                <div class="model-name">Isolation Forest</div>
                                <div class="model-status" id="status-if">Not Trained</div>
                            </div>
                            <div class="model-card">
                                <div class="model-name">Autoencoder</div>
                                <div class="model-status" id="status-ae">Not Trained</div>
                            </div>
                            <div class="model-card">
                                <div class="model-name">XGBoost</div>
                                <div class="model-status" id="status-xgb">Not Trained</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Feature Importance -->
                <div class="card feature-importance">
                    <div class="card-header">
                        <h2>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                            </svg>
                            Top Features
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="feature-bars" id="feature-bars">
                            <!-- Feature bars will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Training Modal -->
        <div class="modal hidden" id="training-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Training Models</h3>
                </div>
                <div class="modal-body">
                    <div class="training-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="training-progress-bar"></div>
                        </div>
                        <span class="progress-text" id="training-status">Initializing...</span>
                    </div>
                    <div class="training-log" id="training-log">
                        <!-- Training logs will appear here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div class="toast hidden" id="toast">
            <span class="toast-message"></span>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
